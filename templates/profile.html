<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!--<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml"> 
-->
<head>
<script src="http://maps.google.com/maps/api/js?sensor=false">" type="text/javascript"></script>
<script type="text/javascript" src="/site_media/jquery.js"></script>
<!-- <script type="text/javascript" src="/site_media/ajax.js"></script> -->
<script>
var maxlat = 0
var maxlon = 0
var minlat = 360
var minlon = 360
function placeMarker(map, item){
	var display = item.display;
	var venueName = item.venue.name;
	var lat = item.venue.geolat;
	var lon = item.venue.geolong;
	if (lat > maxlat) {  maxlat = lat;}
	if (lat < minlat) { minlat = lat;}

	if (lon > maxlon) { maxlon = lon;}
	if (lon < minlon) { minlon = lon;}

	//Make a point and put it on the map
	var point = new google.maps.LatLng(lat, lon);
	map.set_center(point);
	var myOptions = {zoom:4, center:point,mapTypeId: google.maps.MapTypeId.ROADMAP,}

	var marker = new google.maps.Marker({
		position: point,
		map: map,
		title: item.user.firstname + " " + item.user.lastname,
	});

	google.maps.event.addListener(marker, 'click', function(){
		infowindow.open(map,marker);
	});

	var shout = item.shout
	if (shout == null){
		shout = ''
	}
	var venueLink = 'http://playfoursquare.com/venue/'+item.venue.id

	var contentString = '<table><tr><td><a href=# onclick=getUser('+item.user.id+')><img height=40px src=\''
						+item.user.photo+'\'</td>'
						+'<td>'+item.user.firstname+' '
						+item.user.lastname
						+'</a><br>@<a href=\''
						+venueLink+'\'>'
						+item.venue.name+'</a><br><i>'
						+shout+'</i> <img src=\'site_media/yelp.gif\'></td></tr></table>'

var infowindow = new google.maps.InfoWindow({
    content: contentString
});

}

function getUser(uid){
	$.getJSON("/getUser/?uid="+uid,
		function(data){
			a = eval("("+data+")");
			}
		);
}
function putStuffInProfilePane(data){
	//Take stuff from data
	x = eval("("+data+")");
	var first = x.user.firstname
	var last = x.user.lastname
	var city = x.user.city.name
	var photo = x.user.photo
	var gender = x.user.gender
	var checkin_time = x.user.checkin.created
	var venue = x.user.checkin.venue.id
	var venue_link = 'http://playfoursquare.com/venue/'+venue
	var venue_name = x.user.checkin.venue.name
	var shout = x.user.checkin.shout
	var rss = x.user.settings.feeds_key
	if (shout == null){ shout = ''; }
	var userInfo = document.getElementById('userinfo');

	//setup the new div
	var newdiv = document.createElement('div');
	newdiv.innerHTML = "<img src = "+photo+">"+shout+"<br><b>"+first+" "+ last +"</b><br><a href="+venue_link+">"+venue_name+"</a><br><font size=1> "+ checkin_time+"<br><a href=# onclick=loadMyCheckins('"+rss+"')>my checkins</font>"
	userInfo.appendChild(newdiv);
}

function gotMyCheckins(data){
	alert("got my checkins")
	}
function loadMyCheckins(feed){
	$.getJSON("/getMyCheckins/?rss="+feed, gotMyCheckins);
	}
function doneLoading(){
	$.getJSON("/getFriends/",
        function(data){
			a = eval("("+data+")");
          $.each(a['checkins'], function(i,item){
				placeMarker(map, item)
			});
            //$("<img/>").attr("src", item.media.m).appendTo("#images");
            //if ( i == 3 ) return false;
			//map.panTo(new GLatLng(minlon, minlat), 13);
	});
	$.getJSON("/getUser/",
		function(data){
			putStuffInProfilePane(data);
		});
}
$(document).ready(doneLoading);


</script>
<link rel="stylesheet" href="/site_media/style.css" type="text/css" media="screen"  charset="utf-8">
<!-- <script src="http://maps.google.com/maps?file=api&v=3&sensor=false&key=ABQIAAAAsYU_U_jVNoazWwWCRWxUmBS9bZigRblo2VqATPXK02zobVRVkhS3BtcPtFP8sXQ3yrRk35yzCld3EQ" type="text/javascript"></script> -->
    <script type="text/javascript">

	var map;
    function initialize() {
		var latlng = new google.maps.LatLng(-34.397, 150.644);
		var myOptions = {
			zoom: 8,
			center: latlng,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    }

    </script>

</head>
<body onload="initialize()" onunload="GUnload()">
<div class = "tabArea" border=1>
<div>
you are logged in as {{username}}
</div>
<div>
<a href="/addServices">Add services</a>
</div>
</div>
</div>

<div class="tabMain clearfix" color:#606060 background-color: #f4f2f3>
	<div class="logoArea">
	</div>
    <div class="profileinfo" width: 25%; height:100%; padding:0; float:left; border:2px solid #101010>
    	<div>
        <h2 >Profile Info for: </h2>
        </div>
        <div id="userinfo">
        </div>
    </div>

    <div class =mapcontent id="map_canvas" width: 70%; height:100%; float:right;>
        This is where the map goes
    </div>
</div>
</body>
</html>
